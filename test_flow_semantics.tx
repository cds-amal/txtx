# Test case demonstrating flow semantics
# This runbook will execute THREE times - once for each flow

flow "mainnet" {
    description = "Production deployment"
    chain_id = 1
    rpc_url = "https://mainnet.infura.io"
    gas_price = 30000000000  # 30 gwei
}

flow "testnet" {
    description = "Test deployment"
    chain_id = 5
    rpc_url = "https://goerli.infura.io"
    gas_price = 1000000000   # 1 gwei
    # Note: missing 'network_name' that exists in other flows
}

flow "localhost" {
    description = "Local development"
    chain_id = 31337
    rpc_url = "http://localhost:8545"
    gas_price = 0
    network_name = "hardhat"  # Only in this flow and mainnet
}

# This variable will have different values in each flow execution
variable "deployment_chain" {
    value = flow.chain_id  # OK: exists in all flows
}

# This will cause an ERROR - network_name doesn't exist in testnet flow
variable "network" {
    value = flow.network_name  # ERROR: missing in testnet flow
}

# This action will execute 3 times with different configs
action "deploy" "evm::deploy" {
    chain_id = flow.chain_id     # Different for each flow
    rpc_url = flow.rpc_url       # Different for each flow
    gas_price = flow.gas_price   # Different for each flow
}

output "deployment_info" {
    value = action.deploy.address
    description = "Contract deployed to chain ${flow.chain_id}"
}